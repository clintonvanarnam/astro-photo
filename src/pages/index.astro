---
import { client } from '../lib/sanityClient.js'
import { photosQuery } from '../lib/queries.js'

let posts = [];
let fetchError = null;
try {
  posts = await client.fetch(photosQuery) || [];
  console.log('Fetched posts:', posts);
} catch (e) {
  console.error('Error fetching posts:', e);
  fetchError = e.message || e.toString();
  posts = [];
}
---

<html>
  <head>
    <title>DOMAIN KING</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/src/assets/main.css" />
  </head>
  <body>
    <div id="intro-overlay" style="position:fixed; top:0; left:0; width:100vw; height:100vh; background:#fff; z-index:2000; display:flex; align-items:center; justify-content:center;">
      <canvas id="three-canvas" style="position:absolute; top:0; left:0; width:100vw; height:100vh; z-index:2100; background:transparent;"></canvas>
      <div id="custom-cursor" style="position:absolute; pointer-events:none; font-size:10px; color:#222; font-family:monospace; background:none; padding:0; border:none; box-shadow:none; font-weight:400;">
        [click]
      </div>
    </div>
    <div id="soundcloud-controls" style="position:fixed; top:18px; right:24px; z-index:3000; display:flex; align-items:center; gap:16px; font-size:10px; font-family:monospace;">
      <div id="soundcloud-player" style="display:none;"></div>
      <div id="mute-toggle" style="display:none; cursor:pointer;">mute</div>
      <pre id="sound-visual" style="margin:0; padding:0; background:none; border:none; color:#fff; font-family:monospace; font-size:10px; line-height:1;">||||||||||</pre>
    </div>
    <div id="main-content" style="display:none;">
      {fetchError && (
        <div style="color: red; font-weight: bold;">Error fetching posts: {fetchError}</div>
      )}
      {(!posts || posts.length === 0) && !fetchError && (
        <div style="color: orange; font-weight: bold;">No posts found.</div>
      )}
      <div class="gallery-grid">
        {(posts || []).map((post, idx) => (
          <div>
            <img class="lightbox-thumb" data-url={post.mainImage?.asset?.url} data-alt={post.title} src={post.mainImage?.asset?.url} alt={post.title} style="width: 100%; cursor: pointer;" />
          </div>
        ))}
      </div>
      <div id="lightbox-overlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.8); align-items:center; justify-content:center; z-index:1000; opacity:0; transition:opacity 0.3s;">
        <img id="lightbox-img" src="" alt="" style="max-width:90vw; max-height:90vh; box-shadow:0 0 20px #000; transition:transform 0.3s; transform:scale(0.95);" />
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/three@0.149.0/build/three.min.js"></script>
    <script src="/src/assets/three/FontLoader.js"></script>
    <script src="/src/assets/three/TextGeometry.js"></script>
    <script src="/src/assets/three-domainking.js"></script>
    <script src="/src/assets/main.js"></script>
  </body>
</html>