---
import { client } from '../lib/sanityClient.js'
import { photosQuery } from '../lib/queries.js'

let posts = [];
let fetchError = null;
try {
  posts = await client.fetch(photosQuery) || [];
  console.log('Fetched posts:', posts);
} catch (e) {
  console.error('Error fetching posts:', e);
  fetchError = e.message || e.toString();
  posts = [];
}
---

<html>
  <head>
    <title>Sanity + Astro Photo Site</title>
  </head>
  <body>
    <h1>DOMAIN KING</h1>
    {fetchError && (
      <div style="color: red; font-weight: bold;">Error fetching posts: {fetchError}</div>
    )}
    {(!posts || posts.length === 0) && !fetchError && (
      <div style="color: orange; font-weight: bold;">No posts found.</div>
    )}
    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem;">
      {(posts || []).map(post => (
        <div>
          <img src={post.mainImage?.asset?.url} alt={post.title} style="width: 100%;" />
        </div>
      ))}
    </div>
  </body>
</html>